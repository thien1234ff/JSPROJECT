<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diễn đàn Nông nghiệp Thông minh</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
        }
        .post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        .category-tag {
            transition: all 0.3s ease;
        }
        .category-tag:hover {
            transform: scale(1.05);
        }
        .avatar {
            transition: transform 0.3s ease;
        }
        .avatar:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Header -->
    <header class="bg-green-700 text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fas fa-leaf text-2xl"></i>
                <h1 class="text-2xl font-bold">Nông Nghiệp Thông Minh</h1>
            </div>
            <nav class="hidden md:flex space-x-6">
                <a href="index.html" class="hover:text-green-200 transition">Trang chủ</a>
                <a href="#" class="hover:text-green-200 transition">Diễn đàn</a>
                <a href="#" class="hover:text-green-200 transition">Kiến thức</a>
                <a href="#" class="hover:text-green-200 transition">Cộng đồng</a>
                <!-- Thêm vào phần header -->
                <span id="userName" class="ml-4 text-white font-semibold hidden"></span>
                <button id="logoutBtn" class="ml-4 bg-red-600 px-4 py-2 rounded hover:bg-red-700 text-white hidden">
                    Đăng xuất
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Hero Section -->
        <section class="mb-12 text-center">
            <h2 class="text-4xl font-bold text-green-800 mb-4">Diễn đàn Cộng đồng Nông dân</h2>
            <p class="text-xl text-gray-700 max-w-3xl mx-auto">
                Chia sẻ kinh nghiệm, học hỏi phương pháp canh tác mới và kết nối với cộng đồng nông dân thông minh
            </p>
        </section>

        <!-- Forum Actions -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-4">
            <!-- Search -->
            <div class="relative w-full md:w-96">
                <input type="text" placeholder="Tìm kiếm bài viết, chủ đề..." 
                       class="w-full pl-10 pr-4 py-2 rounded-full border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500">
                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
            </div>
            
            <!-- New Post Button -->
            <button id="newPostBtn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-medium transition flex items-center whitespace-nowrap">
                <i class="fas fa-plus mr-2"></i> Đăng bài mới
            </button>
        </div>

        <!-- Categories -->
        <div class="mb-8">
            <h3 class="text-xl font-semibold mb-4 text-green-800">Chủ đề phổ biến</h3>
            <div class="flex flex-wrap gap-3">
                <a href="#" class="category-tag bg-green-100 text-green-800 px-4 py-2 rounded-full hover:bg-green-200">Cây lúa</a>
                <a href="#" class="category-tag bg-blue-100 text-blue-800 px-4 py-2 rounded-full hover:bg-blue-200">Cây ăn quả</a>
                <a href="#" class="category-tag bg-yellow-100 text-yellow-800 px-4 py-2 rounded-full hover:bg-yellow-200">Rau màu</a>
                <a href="#" class="category-tag bg-purple-100 text-purple-800 px-4 py-2 rounded-full hover:bg-purple-200">Thủy canh</a>
                <a href="#" class="category-tag bg-red-100 text-red-800 px-4 py-2 rounded-full hover:bg-red-200">Phân bón</a>
                <a href="#" class="category-tag bg-indigo-100 text-indigo-800 px-4 py-2 rounded-full hover:bg-indigo-200">Tưới tiêu</a>
            </div>
        </div>

        <!-- Forum Content -->
        <div class="flex flex-col lg:flex-row gap-8">
            <!-- Posts Section -->
            <div class="lg:w-2/3">
                <!-- Sort Options -->
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-xl font-semibold text-green-800">Bài viết mới nhất</h3>
                    <div class="flex items-center">
                        <span class="mr-2 text-gray-600">Sắp xếp:</span>
                        <select class="border rounded-lg px-3 py-1 focus:outline-none focus:ring-2 focus:ring-green-500">
                            <option>Mới nhất</option>
                            <option>Phổ biến</option>
                            <option>Nhiều bình luận</option>
                        </select>
                    </div>
                </div>

                <!-- Post List -->
                <div class="space-y-6">
                    <!-- Post 1 -->
                    <article class="post-card bg-white rounded-xl shadow-md p-6 transition duration-300">
                        <div class="flex items-start mb-4">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="avatar w-12 h-12 rounded-full mr-4 border-2 border-green-200">
                            <div>
                                <h4 class="font-bold text-lg text-green-800">Kinh nghiệm trồng lúa hữu cơ đạt năng suất cao</h4>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <span class="mr-3">Bởi <a href="#" class="text-green-600 hover:underline">Nguyễn Văn A</a></span>
                                    <span class="mr-3"><i class="far fa-clock mr-1"></i> 2 giờ trước</span>
                                    <span><i class="far fa-comment mr-1"></i> 15 bình luận</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-4">
                            Chia sẻ với bà con phương pháp trồng lúa hữu cơ mà tôi đã áp dụng thành công trong 3 năm qua, năng suất đạt 8 tấn/ha, giảm 30% chi phí đầu vào so với canh tác truyền thống...
                        </p>
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">Lúa</span>
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">Hữu cơ</span>
                            </div>
                            <button class="text-green-600 hover:text-green-800 font-medium">Đọc tiếp →</button>
                        </div>
                    </article>

                    <!-- Post 2 -->
                    <article class="post-card bg-white rounded-xl shadow-md p-6 transition duration-300">
                        <div class="flex items-start mb-4">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User" class="avatar w-12 h-12 rounded-full mr-4 border-2 border-green-200">
                            <div>
                                <h4 class="font-bold text-lg text-green-800">Giải pháp tưới nhỏ giọt tự động cho vườn cây ăn trái</h4>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <span class="mr-3">Bởi <a href="#" class="text-green-600 hover:underline">Trần Thị B</a></span>
                                    <span class="mr-3"><i class="far fa-clock mr-1"></i> 5 giờ trước</span>
                                    <span><i class="far fa-comment mr-1"></i> 8 bình luận</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-4">
                            Sau 2 năm nghiên cứu và thử nghiệm, tôi đã xây dựng thành công hệ thống tưới nhỏ giọt tự động với chi phí chỉ 15 triệu đồng cho 1ha vườn cây ăn trái. Hệ thống giúp tiết kiệm 50% lượng nước và giảm công lao động...
                        </p>
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">Cây ăn quả</span>
                                <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm">Tưới tiêu</span>
                                <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm">Tự động hóa</span>
                            </div>
                            <button class="text-green-600 hover:text-green-800 font-medium">Đọc tiếp →</button>
                        </div>
                    </article>

                    <!-- Post 3 -->
                    <article class="post-card bg-white rounded-xl shadow-md p-6 transition duration-300">
                        <div class="flex items-start mb-4">
                            <img src="https://randomuser.me/api/portraits/men/75.jpg" alt="User" class="avatar w-12 h-12 rounded-full mr-4 border-2 border-green-200">
                            <div>
                                <h4 class="font-bold text-lg text-green-800">Cách phòng trừ sâu bệnh trên rau màu không dùng thuốc hóa học</h4>
                                <div class="flex items-center text-sm text-gray-500 mt-1">
                                    <span class="mr-3">Bởi <a href="#" class="text-green-600 hover:underline">Lê Văn C</a></span>
                                    <span class="mr-3"><i class="far fa-clock mr-1"></i> 1 ngày trước</span>
                                    <span><i class="far fa-comment mr-1"></i> 23 bình luận</span>
                                </div>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-4">
                            Xin chia sẻ với bà con các biện pháp phòng trừ sâu bệnh bằng chế phẩm sinh học tự chế từ tỏi, ớt, gừng và rượu. Phương pháp này tôi đã áp dụng 5 năm nay, hiệu quả đạt 80-90%, an toàn cho người sử dụng và môi trường...
                        </p>
                        <div class="flex justify-between items-center">
                            <div class="flex space-x-2">
                                <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm">Rau màu</span>
                                <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">Hữu cơ</span>
                                <span class="bg-red-100 text-red-800 px-3 py-1 rounded-full text-sm">Sâu bệnh</span>
                            </div>
                            <button class="text-green-600 hover:text-green-800 font-medium">Đọc tiếp →</button>
                        </div>
                    </article>
                </div>

                <!-- Pagination -->
                <div class="mt-8 flex justify-center">
                    <nav class="flex items-center space-x-1">
                        <button class="px-3 py-1 rounded-lg border border-gray-300 text-gray-500 hover:bg-gray-100">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="px-3 py-1 rounded-lg bg-green-600 text-white">1</button>
                        <button class="px-3 py-1 rounded-lg border border-gray-300 hover:bg-gray-100">2</button>
                        <button class="px-3 py-1 rounded-lg border border-gray-300 hover:bg-gray-100">3</button>
                        <span class="px-2">...</span>
                        <button class="px-3 py-1 rounded-lg border border-gray-300 hover:bg-gray-100">8</button>
                        <button class="px-3 py-1 rounded-lg border border-gray-300 text-gray-500 hover:bg-gray-100">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </nav>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="lg:w-1/3 space-y-6">
                <!-- Popular Topics -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4 text-green-800">Chủ đề nổi bật</h3>
                    <div class="space-y-3">
                        <a href="#" class="flex items-center justify-between hover:text-green-600 transition">
                            <span>Kỹ thuật trồng lúa thông minh</span>
                            <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">142 bài</span>
                        </a>
                        <a href="#" class="flex items-center justify-between hover:text-green-600 transition">
                            <span>Phân bón hữu cơ tự chế</span>
                            <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">87 bài</span>
                        </a>
                        <a href="#" class="flex items-center justify-between hover:text-green-600 transition">
                            <span>Ứng dụng IoT trong nông nghiệp</span>
                            <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">65 bài</span>
                        </a>
                        <a href="#" class="flex items-center justify-between hover:text-green-600 transition">
                            <span>Giống cây trồng mới</span>
                            <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">53 bài</span>
                        </a>
                        <a href="#" class="flex items-center justify-between hover:text-green-600 transition">
                            <span>Thị trường nông sản</span>
                            <span class="bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full">47 bài</span>
                        </a>
                    </div>
                </div>

                <!-- Top Contributors -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4 text-green-800">Thành viên tích cực</h3>
                    <div class="space-y-4">
                        <div class="flex items-center">
                            <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="User" class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <h4 class="font-medium">Nguyễn Văn A</h4>
                                <p class="text-sm text-gray-500">152 bài viết</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="User" class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <h4 class="font-medium">Trần Thị B</h4>
                                <p class="text-sm text-gray-500">98 bài viết</p>
                            </div>
                        </div>
                        <div class="flex items-center">
                            <img src="https://randomuser.me/api/portraits/men/75.jpg" alt="User" class="w-10 h-10 rounded-full mr-3">
                            <div>
                                <h4 class="font-medium">Lê Văn C</h4>
                                <p class="text-sm text-gray-500">87 bài viết</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Forum Statistics -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-semibold mb-4 text-green-800">Thống kê diễn đàn</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-green-50 p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-green-700">1,245</div>
                            <div class="text-sm text-gray-600">Bài viết</div>
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-blue-700">3,872</div>
                            <div class="text-sm text-gray-600">Bình luận</div>
                        </div>
                        <div class="bg-yellow-50 p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-yellow-700">586</div>
                            <div class="text-sm text-gray-600">Thành viên</div>
                        </div>
                        <div class="bg-purple-50 p-3 rounded-lg text-center">
                            <div class="text-2xl font-bold text-purple-700">24</div>
                            <div class="text-sm text-gray-600">Chủ đề</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- New Post Modal -->
    <div id="newPostModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-green-800">Đăng bài viết mới</h3>
                    <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="postForm">
                    <div class="mb-4">
                        <label for="postTitle" class="block text-gray-700 font-medium mb-2">Tiêu đề bài viết</label>
                        <input type="text" id="postTitle" 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" 
                               placeholder="Nhập tiêu đề bài viết của bạn" required>
                    </div>
                    
                    <div class="mb-4">
                        <label for="postCategory" class="block text-gray-700 font-medium mb-2">Chọn chủ đề</label>
                        <select id="postCategory" 
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" required>
                            <option value="">-- Chọn chủ đề --</option>
                            <option value="lúa">Cây lúa</option>
                            <option value="cây ăn quả">Cây ăn quả</option>
                            <option value="rau màu">Rau màu</option>
                            <option value="thủy canh">Thủy canh</option>
                            <option value="phân bón">Phân bón</option>
                            <option value="tưới tiêu">Tưới tiêu</option>
                            <option value="khác">Khác</option>
                        </select>
                    </div>
                    
                    <div class="mb-4">
                        <label for="postContent" class="block text-gray-700 font-medium mb-2">Nội dung bài viết</label>
                        <textarea id="postContent" rows="8" 
                                  class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" 
                                  placeholder="Chia sẻ kinh nghiệm, thắc mắc của bạn với cộng đồng..." required></textarea>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 font-medium mb-2">Thêm hình ảnh (tối đa 3 ảnh)</label>
                        <div class="flex items-center space-x-4">
                            <div class="w-24 h-24 border-2 border-dashed border-gray-300 rounded-lg flex items-center justify-center cursor-pointer hover:bg-gray-50">
                                <i class="fas fa-plus text-gray-400 text-2xl"></i>
                            </div>
                            <div class="text-sm text-gray-500">
                                Kích thước tối đa mỗi ảnh 5MB. Định dạng: JPG, PNG
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelPostBtn" class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition">
                            Hủy bỏ
                        </button>
                        <button type="submit" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                            Đăng bài
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-green-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-xl font-bold mb-4">Nông Nghiệp Thông Minh</h3>
                    <p class="text-green-200">
                        Cộng đồng chia sẻ kiến thức và kinh nghiệm về các phương pháp canh tác hiện đại, bền vững.
                    </p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Liên kết</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-green-200 hover:text-white transition">Trang chủ</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition">Diễn đàn</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition">Kiến thức</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition">Sự kiện</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Hỗ trợ</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-green-200 hover:text-white transition">Câu hỏi thường gặp</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition">Hướng dẫn sử dụng</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition">Điều khoản dịch vụ</a></li>
                        <li><a href="#" class="text-green-200 hover:text-white transition">Chính sách bảo mật</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Kết nối</h4>
                    <div class="flex space-x-4 mb-4">
                        <a href="#" class="w-10 h-10 bg-green-700 rounded-full flex items-center justify-center hover:bg-green-600 transition">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-green-700 rounded-full flex items-center justify-center hover:bg-green-600 transition">
                            <i class="fab fa-youtube"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-green-700 rounded-full flex items-center justify-center hover:bg-green-600 transition">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="#" class="w-10 h-10 bg-green-700 rounded-full flex items-center justify-center hover:bg-green-600 transition">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                    <p class="text-green-200">
                        Email: support@nongnghiepthongminh.vn
                    </p>
                </div>
            </div>
            <div class="border-t border-green-700 mt-8 pt-6 text-center text-green-300">
                <p>© 2023 Nông Nghiệp Thông Minh. Tất cả quyền được bảo lưu.</p>
            </div>
        </div>
    </footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    serverTimestamp,
    orderBy,
    query
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  import {
    getAuth,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA6WyGsOeOlct2BcOeQSZ6ogo2aGUa_MyQ",
    authDomain: "nongnghiepxanh-f6689.firebaseapp.com",
    projectId: "nongnghiepxanh-f6689",
    storageBucket: "nongnghiepxanh-f6689.appspot.com",
    messagingSenderId: "846834085038",
    appId: "1:846834085038:web:cfac519e025896626d113f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth();
  let currentUser = null;

  // Theo dõi trạng thái đăng nhập
  onAuthStateChanged(auth, (user) => {
    if (user) {
      currentUser = user;
      document.getElementById("userName").textContent =
        `Xin chào, ${user.displayName || user.email}`;
      document.getElementById("userName").classList.remove("hidden");
      document.getElementById("logoutBtn").classList.remove("hidden");
    } else {
      currentUser = null;
      alert("Bạn chưa đăng nhập! Vui lòng đăng nhập trước.");
      window.location.href = "index.html";
    }
  });

  // Logout
  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await signOut(auth);
    alert("Đã đăng xuất.");
    window.location.href = "index.html";
  });

  // Modal logic
  const newPostBtn = document.getElementById("newPostBtn");
  const newPostModal = document.getElementById("newPostModal");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const cancelPostBtn = document.getElementById("cancelPostBtn");
  const postForm = document.getElementById("postForm");

  newPostBtn.addEventListener("click", () => {
    if (!currentUser) {
      alert("Vui lòng đăng nhập trước khi đăng bài!");
      return;
    }
    newPostModal.classList.remove("hidden");
    document.body.style.overflow = "hidden";
  });

  closeModalBtn.addEventListener("click", closeModal);
  cancelPostBtn.addEventListener("click", closeModal);
  newPostModal.addEventListener("click", (e) => {
    if (e.target === newPostModal) {
      closeModal();
    }
  });

  function closeModal() {
    newPostModal.classList.add("hidden");
    document.body.style.overflow = "auto";
    postForm.reset();
  }

  postForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const title = document.getElementById("postTitle").value.trim();
    const category = document.getElementById("postCategory").value;
    const content = document.getElementById("postContent").value.trim();

    if (!title || !category || !content) {
      alert("Vui lòng điền đầy đủ thông tin!");
      return;
    }

    const postData = {
      title,
      category,
      content,
      createdAt: serverTimestamp(),
      author: currentUser.displayName || currentUser.email,
      comments: 0
    };

    try {
      await addDoc(collection(db, "posts"), postData);
      alert("Bài viết đã được lưu!");
      closeModal();
      loadPosts();
    } catch (error) {
      console.error(error);
      alert("Lỗi khi lưu bài viết!");
    }
  });

  async function loadPosts() {
    const postsContainer = document.querySelector(".space-y-6");
    postsContainer.innerHTML = "";

    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const snapshot = await getDocs(q);

    if (snapshot.empty) {
      postsContainer.innerHTML = "<p class='text-gray-600'>Chưa có bài viết nào.</p>";
    } else {
      snapshot.forEach((docSnap) => {
        const post = docSnap.data();
        const postHtml = createPostCard(post);
        postsContainer.insertAdjacentHTML("beforeend", postHtml);
      });
    }
  }

  function createPostCard(post) {
    const categoryColorMap = {
      "lúa": "green",
      "cây ăn quả": "blue",
      "rau màu": "yellow",
      "thủy canh": "purple",
      "phân bón": "red",
      "tưới tiêu": "indigo",
      "khác": "gray"
    };

    const color = categoryColorMap[post.category] || "gray";

    return `
      <article class="post-card bg-white rounded-xl shadow-md p-6 transition duration-300">
        <div class="flex items-start mb-4">
          <img src="https://randomuser.me/api/portraits/lego/1.jpg" alt="User" class="avatar w-12 h-12 rounded-full mr-4 border-2 border-green-200">
          <div>
            <h4 class="font-bold text-lg text-green-800">${post.title}</h4>
            <div class="flex items-center text-sm text-gray-500 mt-1">
              <span class="mr-3">Bởi <a href="#" class="text-green-600 hover:underline">${post.author}</a></span>
              <span class="mr-3"><i class="far fa-clock mr-1"></i> Mới đăng</span>
              <span><i class="far fa-comment mr-1"></i> ${post.comments} bình luận</span>
            </div>
          </div>
        </div>
        <p class="text-gray-700 mb-4">${post.content}</p>
        <div class="flex justify-between items-center">
          <div class="flex space-x-2">
            <span class="bg-${color}-100 text-${color}-800 px-3 py-1 rounded-full text-sm">${post.category}</span>
          </div>
          <button class="text-green-600 hover:text-green-800 font-medium">Đọc tiếp →</button>
        </div>
      </article>
    `;
  }

  document.addEventListener("DOMContentLoaded", loadPosts);
</script>
</body>
</html>