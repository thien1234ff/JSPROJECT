<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trang Chủ - Smart Agriculture</title>
  <link rel="icon" type="image/png" href="/placeholder.svg?height=32&width=32">
  <link rel="stylesheet" href="index.css">
  <link rel="icon" type="image/png" href="logo.png">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
</head>
<body>
  <!-- 1. Header (Phần đầu trang) -->
  <header>
    <div class="logo">
      <img src="/JSPROJECT/logo.png" alt="Logo" class="logo-icon">
      SMART AGRICULTURE
    </div>
    <nav>
      <ul>
        <li><a href="#home">Trang chủ</a></li>
        <li><a href="#features">Tính năng / Module</a></li>
        <li><a href="forum.html">Diễn đàn</a></li>
        <li><a href="payment.html">Sản phẩm</a></li>
        <li><a href="knowledgebase.html">Tin tức / Hướng dẫn</a></li>
        <li><a href="#contact">Liên hệ</a></li>
        <!-- Tách nút Đăng nhập / Đăng ký -->
        <li><a href="login.html" id="loginLink">Đăng nhập</a></li>
        <li><a href="register.html" id="registerLink">Đăng ký</a></li>
        <li><a href="#" id="profileLink" style="display: none;">Tài khoản</a></li> <!-- Sẽ hiển thị khi đăng nhập -->
        <li><a href="#" id="logoutLink" style="display: none;">Đăng xuất</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <!-- 2. Hero Section (Khu vực ấn tượng đầu trang) -->
    <section id="home" class="hero-section">
      <video autoplay muted loop playsinline class="hero-background">
        <source src="/JSPROJECT/hero-video.mp4" type="video/mp4">
        Trình duyệt của bạn không hỗ trợ video nền.
      </video>
      <div class="hero-overlay"></div>
      <div class="hero-content">
        <h1>Chuyển đổi số nông nghiệp – Tối ưu hóa canh tác</h1>
        <div class="hero-cta">
          <a href="#features" class="button primary">Bắt đầu ngay</a>
        </div>
      </div>
    </section>
    <!-- 3. Danh Sách Tính Năng Chính (Core Features) -->
    <section id="features" class="core-features-section">
      <h2>Danh Sách Tính Năng Chính</h2>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">📈</div>
          <h3>Dự đoán năng suất</h3>
          <p>Sử dụng AI để dự báo năng suất cây trồng, giúp bạn lập kế hoạch hiệu quả hơn.</p>
          <a href="crop-prediction.html" class="button outline-primary">Xem chi tiết</a>
        </div>
        <div class="feature-card">
          <div class="feature-icon">🌦️</div>
          <h3>Dự báo thời tiết</h3>
          <p>Cung cấp thông tin thời tiết chính xác, cảnh báo sớm các điều kiện bất lợi.</p>
          <a href="map.html" class="button outline-primary">Xem chi tiết</a>
        </div>
        <div class="feature-card">
          <div class="feature-icon">🧑‍🌾</div>
          <h3>Quản lý nông trại</h3>
          <p>Công cụ toàn diện để quản lý đất đai, cây trồng, và tài nguyên nông trại.</p>
          <a href="Farmmanagement.html" class="button outline-primary">Xem chi tiết</a>
        </div>
        <div class="feature-card">
          <div class="feature-icon">💬</div>
          <h3>Hỗ trợ Chatbot</h3>
          <p>Trợ lý ảo 24/7 giải đáp thắc mắc và cung cấp lời khuyên nông nghiệp.</p>
          <a href="ai.html" class="button outline-primary">Xem chi tiết</a>
        </div>
      </div>
    </section>

    <!-- 4. Sản phẩm Nổi bật (Featured Products Section) -->
    <section id="products" class="products-section">
      <h2>Sản phẩm Nổi bật</h2>
      <div class="product-grid">
        <!-- Products will be loaded here from Firestore -->
        <p id="loadingProducts" style="text-align: center; color: #666;">Đang tải sản phẩm...</p>
        <p id="noProducts" style="text-align: center; color: #666; display: none;">Không có sản phẩm nào để hiển thị.</p>
        <p id="productError" style="text-align: center; color: red; display: none;">Lỗi khi tải sản phẩm. Vui lòng thử lại sau.</p>
      </div>
      <a href="payment.html" class="button primary large view-all-products">Xem tất cả sản phẩm</a>
    </section>
    <!-- 5. Tin tức / Hướng dẫn (Knowledge Section) -->
    <section id="knowledge" class="knowledge-section">
      <h2>Tin tức / Hướng dẫn</h2>
      <div class="articles-grid">
        <!-- Articles will be loaded here from Firestore -->
        <p id="loadingArticles" style="text-align: center; color: #666;">Đang tải bài viết...</p>
        <p id="noArticles" style="text-align: center; color: #666; display: none;">Không có bài viết nào để hiển thị.</p>
        <p id="articleError" style="text-align: center; color: red; display: none;">Lỗi khi tải bài viết. Vui lòng thử lại sau.</p>
      </div>
      <a href="knowledgebase.html" class="button primary large">Xem tất cả bài viết</a> <!-- Updated href -->
    </section>

    <!-- 6. Liên hệ / Đăng ký tư vấn -->
    <section id="contact" class="contact-section">
      <h2>Liên hệ / Đăng ký tư vấn</h2>
      <div class="contact-grid">
        <div class="contact-form-container">
          <h3>Đăng ký nhận hỗ trợ</h3>
          <form class="contact-form" id="consultation-form">
            <label for="name">Họ và tên</label>
            <input type="text" id="name" placeholder="Nguyễn Văn A">

            <label for="email">Email</label>
            <input type="email" id="email" placeholder="email@example.com">

            <label for="phone">Số điện thoại</label>
            <input type="tel" id="phone" placeholder="0901234567">

            <label for="message">Nội dung tin nhắn</label>
            <textarea id="message" placeholder="Bạn cần tư vấn về vấn đề gì?" rows="5"></textarea>

            <button type="submit" class="button primary full-width">Gửi yêu cầu</button>
          </form>
        </div>

        <div class="contact-info-container">
          <h3>Thông tin liên hệ</h3>
          <div class="contact-details">
            <p><span>📧</span> vominhquan17102004@gmail.com</p>
            <p><span>📞</span> +84 76 265 7225</p>
            <p>Địa chỉ: Tầng 81, Tòa nhà LandMark,  Quận 1, TP. Hồ Chí Minh</p>
          </div>
          <div class="social-media">
            <h3>Mạng xã hội</h3>
            <div class="social-icons">
              <a href="https://www.facebook.com/thien.777h" class="social-icon"><i class="bi bi-facebook"></i></a>
              <a href="https://www.instagram.com/sunyidd/" aria-label="Twitter"><i class="bi bi-instagram"></i></a>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- 7. Footer (Chân trang) -->
  <footer>
    <div class="footer-content">
      <div class="footer-section about-project">
        <div class="logo">
          <img src="/JSPROJECT/logo.png" alt="Logo" class="logo-icon">
          SMART AGRICULTURE
        </div>
        <p>Giải pháp nông nghiệp thông minh hàng đầu, giúp tối ưu hóa canh tác và nâng cao năng suất cho nông dân Việt Nam.</p>
      </div>

      <div class="footer-section quick-links">
        <h3>Liên kết nhanh</h3>
        <ul>
          <li><a href="#home">Trang chủ</a></li>
          <li><a href="#about">Giới thiệu</a></li>
          <li><a href="#features">Tính năng</a></li>
          <li><a href="#products">Sản phẩm</a></li>
          <li><a href="#knowledge">Tin tức</a></li>
          <li><a href="#contact">Liên hệ</a></li>
        </ul>
      </div>

      <div class="footer-section policies">
        <h3>Chính sách</h3>
        <ul>
          <li><a href="#">Chính sách quyền riêng tư</a></li>
          <li><a href="#">Điều khoản dịch vụ</a></li>
          <li><a href="#">Chính sách hoàn tiền</a></li>
        </ul>
        <p class="copyright">© 2025 Smart Agriculture. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Firebase Script -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import {
      getFirestore, doc, getDoc,
      collection, query, getDocs, limit, orderBy, addDoc, serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA6WyGsOeOlct2BcOeQSZ6ogo2aGUa_MyQ",
      authDomain: "nongnghiepxanh-f6689.firebaseapp.com",
      projectId: "nongnghiepxanh-f6689",
      storageBucket: "nongnghiepxanh-f6689.firebasestorage.app",
      messagingSenderId: "846834085038",
      appId: "1:846834085038:web:cfac519e025896626d113f",
      measurementId: "G-619BFYRKGT"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user) => {
      const logoutLink = document.getElementById('logoutLink');
      const profileLink = document.getElementById('profileLink');
      const loginLink = document.getElementById('loginLink');
      const registerLink = document.getElementById('registerLink');

      if (user) {
        // User is logged in
        loginLink.style.display = 'none';
        registerLink.style.display = 'none';
        profileLink.style.display = 'block'; // Show profile link

        try {
          const userDoc = await getDoc(doc(db, "users", user.uid));
          if (userDoc.exists()) {
            const role = userDoc.data().role;
            console.log("ROLE CỦA USER:", role);

            if (role === "admin") {
              profileLink.href = "admin-dashboard.html";
              profileLink.textContent = "Admin Panel";
            } else {
              profileLink.href = "profile.html";
              profileLink.textContent = "Tài khoản";
            }
          } else {
            console.log("Không tìm thấy dữ liệu role của user.");
            profileLink.href = "profile.html";
            profileLink.textContent = "Tài khoản";
          }
          logoutLink.style.display = 'block';
        } catch (error) {
          console.error("Lỗi khi lấy role:", error);
        }
      } else {
        // User is logged out
        loginLink.style.display = 'block';
        registerLink.style.display = 'block';
        profileLink.style.display = 'none'; // Hide profile link
        logoutLink.style.display = 'none';
      }
    });

    document.getElementById('logoutLink').addEventListener('click', (event) => {
      event.preventDefault();
      signOut(auth).then(() => {
        location.reload();
      }).catch((error) => {
        console.error('Đăng xuất thất bại:', error.message);
      });
    });
    // --- Fetch Featured Products from Firestore ---
    async function fetchFeaturedProducts() {
  const productGrid = document.querySelector('.product-grid');
  const loadingMessage = document.getElementById('loadingProducts');
  const noProductsMessage = document.getElementById('noProducts');
  const errorMessage = document.getElementById('productError');

  // Reset trạng thái UI
  productGrid.innerHTML = '';
  loadingMessage.style.display = 'block';
  noProductsMessage.style.display = 'none';
  errorMessage.style.display = 'none';

  try {
    const productsCol = collection(db, 'products');
    const q = query(productsCol, limit(4)); // Giới hạn 4 sản phẩm nổi bật
    const productSnapshot = await getDocs(q);

    if (productSnapshot.empty) {
      loadingMessage.style.display = 'none';
      noProductsMessage.style.display = 'block';
      return;
    }

    productSnapshot.forEach(doc => {
      const product = doc.data();

      const productCard = `
        <div class="product-card">
          <img src="${product.imageUrl || '/placeholder.svg?height=200&width=200'}" alt="${product.name || 'Sản phẩm'}" class="product-image">
          <h3 class="product-name">${product.name || 'Chưa đặt tên'}</h3>
          <p class="product-description">${product.description || ''}</p>
          <p class="product-price">${(product.price || 0).toLocaleString('vi-VN')} VNĐ</p>
          <button class="button primary add-to-cart" data-id="${doc.id}">Thêm vào giỏ hàng</button>
        </div>
      `;

      productGrid.insertAdjacentHTML('beforeend', productCard);
    });

    loadingMessage.style.display = 'none';

  } catch (error) {
    console.error("Lỗi khi tải sản phẩm từ Firestore:", error);
    loadingMessage.style.display = 'none';
    errorMessage.style.display = 'block';
  }
}
    // Call the function to fetch products when the page loads
    document.addEventListener('DOMContentLoaded', fetchFeaturedProducts);
    // --- Fetch Knowledge Articles from Firestore ---
    async function fetchKnowledgeArticles() {
      const articlesGrid = document.querySelector('.articles-grid');
      const loadingMessage = document.getElementById('loadingArticles');
      const noArticlesMessage = document.getElementById('noArticles');
      const errorMessage = document.getElementById('articleError');

      loadingMessage.style.display = 'block';
      noArticlesMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      articlesGrid.innerHTML = ''; // Clear existing content

      try {
        const articlesCol = collection(db, 'articles'); // Assuming a collection named 'articles'
        const q = query(articlesCol, orderBy('date', 'desc'), limit(3)); // Get 3 latest articles
        const articleSnapshot = await getDocs(q);

        if (articleSnapshot.empty) {
          noArticlesMessage.style.display = 'block';
          loadingMessage.style.display = 'none';
          return;
        }

        articleSnapshot.forEach(doc => {
          const article = doc.data();
          const articleCard = `
            <div class="article-card">
              <h3>${article.title || 'Không có tiêu đề'}</h3>
              <p>${article.excerpt || ''}</p>
            </div>
          `;
          articlesGrid.insertAdjacentHTML('beforeend', articleCard);
        });

        loadingMessage.style.display = 'none';

      } catch (error) {
        console.error("Lỗi khi tải bài viết từ Firestore:", error);
        errorMessage.style.display = 'block';
        loadingMessage.style.display = 'none';
      }
    }

    // Call functions to fetch data when the page loads
    document.addEventListener('DOMContentLoaded', () => {
      fetchKnowledgeArticles();
    });
    // Handle form submission
    document.getElementById('consultation-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const form = e.target;
    const name = form.name.value;
    const email = form.email.value;
    const phone = form.phone.value;
    const message = form.message.value;

    // Kiểm tra dữ liệu đầu vào
    if (!name || !email || !phone) {
      alert('Vui lòng điền đầy đủ thông tin bắt buộc (Họ tên, Email, SĐT)');
      return;
    }

    try {
      // Thêm dữ liệu vào Firestore
      await addDoc(collection(db, 'consultations'), {
        name,
        email,
        phone,
        message,
        timestamp: serverTimestamp(), // Thêm timestamp tự động
        status: 'pending' // Trạng thái mặc định
      });
      
      alert('Yêu cầu tư vấn đã được gửi thành công! Chúng tôi sẽ liên hệ lại với bạn sớm nhất.');
      form.reset(); // Reset form sau khi gửi thành công
    } catch (error) {
      console.error('Lỗi khi gửi yêu cầu:', error);
      alert('Đã có lỗi xảy ra khi gửi yêu cầu. Vui lòng thử lại sau.');
    }
  });

  </script>
</body>
</html>
