<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>C·ª≠a H√†ng N√¥ng S·∫£n Xanh</title>
  <link rel="icon" type="image/png" href="logo.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px 0;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo {
      font-size: 28px;
      font-weight: bold;
      color: #4CAF50;
      text-decoration: none;
    }

    .nav-links {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .nav-links a {
      text-decoration: none;
      color: #333;
      font-weight: 500;
      padding: 10px 20px;
      border-radius: 25px;
      transition: all 0.3s ease;
    }

    .nav-links a:hover {
      background: #4CAF50;
      color: white;
      transform: translateY(-2px);
    }

    .search-filter-section {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      padding: 30px;
      margin: 30px auto;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    }

    .search-filter-content {
      display: flex;
      gap: 20px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .search-box {
      position: relative;
      flex: 1;
      min-width: 300px;
      max-width: 500px;
    }

    .search-box input {
      width: 100%;
      padding: 15px 50px 15px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 50px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }

    .search-box input:focus {
      border-color: #4CAF50;
      box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
    }

    .search-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
    }

    .category-filter {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .category-btn {
      padding: 12px 24px;
      background: #f5f5f5;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .category-btn:hover,
    .category-btn.active {
      background: #4CAF50;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .products-section {
      padding: 30px 0;
    }

    .section-title {
      text-align: center;
      font-size: 32px;
      font-weight: bold;
      color: white;
      margin-bottom: 40px;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .products-stats {
      text-align: center;
      color: rgba(255, 255, 255, 0.9);
      font-size: 18px;
      margin-bottom: 30px;
    }

    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 30px;
      margin-top: 30px;
    }

    .product-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      transition: all 0.4s ease;
      position: relative;
    }

    .product-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }

    .product-image {
      position: relative;
      overflow: hidden;
      height: 250px;
    }

    .product-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.4s ease;
    }

    .product-card:hover .product-image img {
      transform: scale(1.1);
    }

    .category-badge {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(76, 175, 80, 0.9);
      color: white;
      padding: 6px 12px;
      border-radius: 15px;
      font-size: 12px;
      font-weight: 600;
      backdrop-filter: blur(10px);
    }

    .product-content {
      padding: 25px;
    }

    .product-name {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
      line-height: 1.3;
    }

    .product-description {
      color: #666;
      font-size: 14px;
      line-height: 1.5;
      margin-bottom: 15px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .product-price {
      font-size: 24px;
      font-weight: bold;
      color: #e53935;
      margin-bottom: 20px;
    }

    .product-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      flex: 1;
    }

    .btn-primary:hover {
      background: linear-gradient(45deg, #45a049, #4CAF50);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #666;
      border: 2px solid #e0e0e0;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
      transform: translateY(-2px);
    }

    .no-products {
      text-align: center;
      color: rgba(255, 255, 255, 0.8);
      font-size: 18px;
      padding: 60px 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .loading {
      text-align: center;
      color: white;
      font-size: 18px;
      padding: 40px;
    }

    .loading::after {
      content: '';
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-left: 10px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .cart-icon {
      position: relative;
      cursor: pointer;
    }

    .cart-count {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #e53935;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Cart Modal Styles */
    .cart-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .cart-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    .cart-content {
      background: white;
      border-radius: 20px;
      width: 90%;
      max-width: 600px;
      max-height: 80vh;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .cart-header {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .cart-title {
      font-size: 24px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .close-cart {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background 0.3s ease;
    }

    .close-cart:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .cart-body {
      padding: 0;
      max-height: 400px;
      overflow-y: auto;
    }

    .cart-empty {
      text-align: center;
      padding: 60px 20px;
      color: #666;
      font-size: 18px;
    }

    .cart-item {
      display: flex;
      padding: 20px;
      border-bottom: 1px solid #eee;
      gap: 15px;
      align-items: center;
      transition: background 0.3s ease;
    }

    .cart-item:hover {
      background: #f9f9f9;
    }

    .cart-item-image {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .cart-item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .cart-item-info {
      flex: 1;
    }

    .cart-item-name {
      font-weight: bold;
      font-size: 16px;
      color: #333;
      margin-bottom: 5px;
    }

    .cart-item-price {
      color: #e53935;
      font-weight: bold;
      font-size: 14px;
    }

    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    .quantity-btn {
      background: #4CAF50;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s ease;
    }

    .quantity-btn:hover {
      background: #45a049;
    }

    .quantity-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .quantity-display {
      font-weight: bold;
      min-width: 30px;
      text-align: center;
    }

    .remove-item {
      background: #e53935;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 15px;
      cursor: pointer;
      font-size: 12px;
      transition: background 0.3s ease;
    }

    .remove-item:hover {
      background: #d32f2f;
    }

    .cart-footer {
      background: #f9f9f9;
      padding: 20px;
      border-top: 2px solid #eee;
    }

    .cart-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: bold;
    }

    .cart-actions {
      display: flex;
      gap: 10px;
    }

    .btn-checkout {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      flex: 1;
      transition: all 0.3s ease;
    }

    .btn-checkout:hover {
      background: linear-gradient(45deg, #45a049, #4CAF50);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .btn-clear {
      background: #f44336;
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 25px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-clear:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }

    /* Checkout Modal Styles */
    .checkout-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1001;
      backdrop-filter: blur(5px);
    }

    .checkout-modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    .checkout-content {
      background: white;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .checkout-header {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      padding: 20px;
      text-align: center;
    }

    .checkout-form {
      padding: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: #4CAF50;
    }

    .form-row {
      display: flex;
      gap: 15px;
    }

    .form-row .form-group {
      flex: 1;
    }

    .order-summary {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .summary-total {
      display: flex;
      justify-content: space-between;
      font-weight: bold;
      font-size: 18px;
      color: #4CAF50;
      border-top: 2px solid #eee;
      padding-top: 15px;
      margin-top: 15px;
    }

    .checkout-actions {
      display: flex;
      gap: 10px;
      margin-top: 30px;
    }

    .btn-place-order {
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      flex: 1;
      transition: all 0.3s ease;
    }

    .btn-place-order:hover {
      background: linear-gradient(45deg, #45a049, #4CAF50);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
    }

    .btn-cancel {
      background: #f44336;
      color: white;
      border: none;
      padding: 15px 20px;
      border-radius: 25px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-cancel:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes slideUp {
      from {
        transform: translateY(30px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .header-content {
        justify-content: center;
        text-align: center;
      }
      
      .search-filter-content {
        flex-direction: column;
      }
      
      .search-box {
        min-width: 280px;
      }
      
      .products-grid {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }
      
      .nav-links {
        justify-content: center;
        flex-wrap: wrap;
      }

      .cart-content,
      .checkout-content {
        width: 95%;
        margin: 10px;
      }

      .form-row {
        flex-direction: column;
      }

      .cart-actions,
      .checkout-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="#" class="logo">üå± N√¥ng S·∫£n Xanh</a>
        <nav class="nav-links">
          <a href="index.html">Trang Ch·ªß</a>
          <a href="#products">S·∫£n Ph·∫©m</a>
          <a href="#about">Gi·ªõi Thi·ªáu</a>
          <a href="#" class="cart-icon" onclick="openCart()">
            üõí Gi·ªè H√†ng
            <span class="cart-count" id="cartCount">0</span>
          </a>
        </nav>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <!-- Search and Filter Section -->
      <section class="search-filter-section">
        <div class="search-filter-content">
          <div class="search-box">
            <input 
              type="text" 
              id="searchInput" 
              placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m (g·∫°o, xo√†i, rau...)">
            <span class="search-icon">üîç</span>
          </div>
          <div class="category-filter" id="categoryFilter">
            <button class="category-btn active" data-category="all">T·∫•t C·∫£</button>
          </div>
        </div>
      </section>

      <!-- Products Section -->
      <section class="products-section">
        <h2 class="section-title">S·∫£n Ph·∫©m N√¥ng S·∫£n T∆∞∆°i Ngon</h2>
        <div class="products-stats" id="productsStats">
          <div class="loading">ƒêang t·∫£i s·∫£n ph·∫©m...</div>
        </div>
        <div class="products-grid" id="productsGrid"></div>
      </section>
    </div>
  </main>

  <!-- Cart Modal -->
  <div class="cart-modal" id="cartModal">
    <div class="cart-content">
      <div class="cart-header">
        <div class="cart-title">
          üõí Gi·ªè H√†ng C·ªßa B·∫°n
        </div>
        <button class="close-cart" onclick="closeCart()">√ó</button>
      </div>
      <div class="cart-body" id="cartBody">
        <div class="cart-empty">
          <div style="font-size: 48px; margin-bottom: 20px;">üõí</div>
          <div>Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng</div>
          <div style="color: #999; font-size: 14px; margin-top: 10px;">H√£y th√™m s·∫£n ph·∫©m ƒë·ªÉ b·∫Øt ƒë·∫ßu mua s·∫Øm!</div>
        </div>
      </div>
      <div class="cart-footer" id="cartFooter" style="display: none;">
        <div class="cart-total">
          <span>T·ªïng c·ªông:</span>
          <span id="cartTotalAmount">0 ƒë</span>
        </div>
        <div class="cart-actions">
          <button class="btn-checkout" onclick="proceedToCheckout()">
            üí≥ Thanh To√°n
          </button>
          <button class="btn-clear" onclick="clearCart()">
            üóëÔ∏è X√≥a T·∫•t C·∫£
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Checkout Modal -->
  <div class="checkout-modal" id="checkoutModal">
    <div class="checkout-content">
      <div class="checkout-header">
        <h2>üí≥ Thanh To√°n ƒê∆°n H√†ng</h2>
      </div>
      <form class="checkout-form" id="checkoutForm">
        <div class="order-summary">
          <h3 style="margin-bottom: 15px;">üì¶ Th√¥ng Tin ƒê∆°n H√†ng</h3>
          <div id="orderSummary"></div>
          <div class="summary-total">
            <span>T·ªïng Thanh To√°n:</span>
            <span id="checkoutTotal">0 ƒë</span>
          </div>
        </div>

        <h3 style="margin-bottom: 20px;">üë§ Th√¥ng Tin Kh√°ch H√†ng</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="customerName">H·ªç v√† T√™n *</label>
            <input type="text" id="customerName" name="customerName" required>
          </div>
          <div class="form-group">
            <label for="customerPhone">S·ªë ƒêi·ªán Tho·∫°i *</label>
            <input type="tel" id="customerPhone" name="customerPhone" required>
          </div>
        </div>

        <div class="form-group">
          <label for="customerEmail">Email</label>
          <input type="email" id="customerEmail" name="customerEmail">
        </div>

        <div class="form-group">
          <label for="customerAddress">ƒê·ªãa Ch·ªâ Giao H√†ng *</label>
          <textarea id="customerAddress" name="customerAddress" rows="3" required placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ chi ti·∫øt..."></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="paymentMethod">Ph∆∞∆°ng Th·ª©c Thanh To√°n *</label>
            <select id="paymentMethod" name="paymentMethod" required>
              <option value="">Ch·ªçn ph∆∞∆°ng th·ª©c</option>
              <option value="cod">Thanh to√°n khi nh·∫≠n h√†ng (COD)</option>
              <option value="bank">Chuy·ªÉn kho·∫£n ng√¢n h√†ng</option>
              <option value="momo">V√≠ MoMo</option>
              <option value="card">Th·∫ª t√≠n d·ª•ng/ghi n·ª£</option>
            </select>
          </div>
          <div class="form-group">
            <label for="deliveryTime">Th·ªùi Gian Giao H√†ng</label>
            <select id="deliveryTime" name="deliveryTime">
              <option value="standard">Giao h√†ng ti√™u chu·∫©n (2-3 ng√†y)</option>
              <option value="fast">Giao h√†ng nhanh (1-2 ng√†y)</option>
              <option value="express">Giao h√†ng h·ªèa t·ªëc (trong ng√†y)</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="orderNote">Ghi Ch√∫ ƒê∆°n H√†ng</label>
          <textarea id="orderNote" name="orderNote" rows="2" placeholder="Ghi ch√∫ ƒë·∫∑c bi·ªát cho ƒë∆°n h√†ng..."></textarea>
        </div>

        <div class="checkout-actions">
          <button type="submit" class="btn-place-order">
            ‚úÖ ƒê·∫∑t H√†ng
          </button>
          <button type="button" class="btn-cancel" onclick="closeCheckout()">
            ‚ùå H·ªßy
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      onSnapshot,
      query,
      orderBy,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA6WyGsOeOlct2BcOeQSZ6ogo2aGUa_MyQ",
      authDomain: "nongnghiepxanh-f6689.firebaseapp.com",
      projectId: "nongnghiepxanh-f6689",
      storageBucket: "nongnghiepxanh-f6689.appspot.com",
      messagingSenderId: "846834085038",
      appId: "1:846834085038:web:cfac519e025896626d113f",
      measurementId: "G-619BFYRKGT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const productsCol = collection(db, "products");
    const ordersCol = collection(db, "orders");

    let allProducts = [];
    let filteredProducts = [];
    let currentCategory = 'all';
    let searchTerm = '';
    let cart = JSON.parse(localStorage.getItem('cart') || '[]');

    // Update cart count
    function updateCartCount() {
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      document.getElementById('cartCount').textContent = totalItems;
    }

    // Add to cart function
    function addToCart(product) {
      const existingItem = cart.find(item => item.id === product.id);
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({
          id: product.id,
          name: product.name,
          price: product.price,
          imageUrl: product.imageUrl,
          quantity: 1
        });
      }
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      
      // Show success message
      showNotification(`ƒê√£ th√™m "${product.name}" v√†o gi·ªè h√†ng! üõí`);
    }

    // Remove from cart
    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      localStorage.setItem('cart', JSON.stringify(cart));
      updateCartCount();
      renderCart();
      showNotification('ƒê√£ x√≥a s·∫£n ph·∫©m kh·ªèi gi·ªè h√†ng! üóëÔ∏è');
    }

    // Update cart item quantity
    function updateCartQuantity(productId, change) {
      const item = cart.find(item => item.id === productId);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeFromCart(productId);
          return;
        }
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        renderCart();
      }
    }

    // Clear entire cart
    function clearCart() {
      if (confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t·∫•t c·∫£ s·∫£n ph·∫©m trong gi·ªè h√†ng?')) {
        cart = [];
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        renderCart();
        showNotification('ƒê√£ x√≥a t·∫•t c·∫£ s·∫£n ph·∫©m trong gi·ªè h√†ng! üóëÔ∏è');
      }
    }

    // Calculate cart total
    function calculateCartTotal() {
      return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    }

    // Render cart
    function renderCart() {
      const cartBody = document.getElementById('cartBody');
      const cartFooter = document.getElementById('cartFooter');
      const cartTotalAmount = document.getElementById('cartTotalAmount');

      if (cart.length === 0) {
        cartBody.innerHTML = `
          <div class="cart-empty">
            <div style="font-size: 48px; margin-bottom: 20px;">üõí</div>
            <div>Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng</div>
            <div style="color: #999; font-size: 14px; margin-top: 10px;">H√£y th√™m s·∫£n ph·∫©m ƒë·ªÉ b·∫Øt ƒë·∫ßu mua s·∫Øm!</div>
          </div>
        `;
        cartFooter.style.display = 'none';
        return;
      }

      cartFooter.style.display = 'block';
      cartTotalAmount.textContent = calculateCartTotal().toLocaleString('vi-VN') + ' ƒë';

      cartBody.innerHTML = cart.map(item => `
        <div class="cart-item">
          <div class="cart-item-image">
            <img src="${item.imageUrl}" alt="${item.name}" 
                 onerror="this.src='https://via.placeholder.com/80x80/4CAF50/white?text=üå±'">
          </div>
          <div class="cart-item-info">
            <div class="cart-item-name">${item.name}</div>
            <div class="cart-item-price">${item.price.toLocaleString('vi-VN')} ƒë</div>
            <div class="cart-item-controls">
              <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', -1)" ${item.quantity <= 1 ? 'disabled' : ''}>-</button>
              <span class="quantity-display">${item.quantity}</span>
              <button class="quantity-btn" onclick="updateCartQuantity('${item.id}', 1)">+</button>
              <button class="remove-item" onclick="removeFromCart('${item.id}')">X√≥a</button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Open cart modal
    function openCart() {
      renderCart();
      document.getElementById('cartModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close cart modal
    function closeCart() {
      document.getElementById('cartModal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Proceed to checkout
    function proceedToCheckout() {
      if (cart.length === 0) {
        showNotification('Gi·ªè h√†ng tr·ªëng! Vui l√≤ng th√™m s·∫£n ph·∫©m tr∆∞·ªõc khi thanh to√°n.');
        return;
      }

      renderOrderSummary();
      closeCart();
      document.getElementById('checkoutModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    // Close checkout modal
    function closeCheckout() {
      document.getElementById('checkoutModal').classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    // Render order summary
    function renderOrderSummary() {
      const orderSummary = document.getElementById('orderSummary');
      const checkoutTotal = document.getElementById('checkoutTotal');
      
      const total = calculateCartTotal();
      const shipping = total > 500000 ? 0 : 30000; // Free shipping for orders over 500k
      const finalTotal = total + shipping;

      orderSummary.innerHTML = cart.map(item => `
        <div class="summary-item">
          <span>${item.name} √ó ${item.quantity}</span>
          <span>${(item.price * item.quantity).toLocaleString('vi-VN')} ƒë</span>
        </div>
      `).join('') + `
        <div class="summary-item">
          <span>Ph√≠ v·∫≠n chuy·ªÉn</span>
          <span>${shipping === 0 ? 'Mi·ªÖn ph√≠' : shipping.toLocaleString('vi-VN') + ' ƒë'}</span>
        </div>
      `;

      checkoutTotal.textContent = finalTotal.toLocaleString('vi-VN') + ' ƒë';
    }

    // Handle checkout form submission
    document.getElementById('checkoutForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const orderData = {
        customerInfo: {
          name: formData.get('customerName'),
          phone: formData.get('customerPhone'),
          email: formData.get('customerEmail'),
          address: formData.get('customerAddress')
        },
        items: cart.map(item => ({
          id: item.id,
          name: item.name,
          price: item.price,
          quantity: item.quantity,
          total: item.price * item.quantity
        })),
        paymentMethod: formData.get('paymentMethod'),
        deliveryTime: formData.get('deliveryTime'),
        note: formData.get('orderNote'),
        subtotal: calculateCartTotal(),
        shipping: calculateCartTotal() > 500000 ? 0 : 30000,
        total: calculateCartTotal() + (calculateCartTotal() > 500000 ? 0 : 30000),
        status: 'pending',
        createdAt: serverTimestamp()
      };

      try {
        // Show loading
        const submitBtn = e.target.querySelector('.btn-place-order');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'ƒêang x·ª≠ l√Ω...';
        submitBtn.disabled = true;

        // Save order to Firebase
        await addDoc(ordersCol, orderData);
        
        // Clear cart
        cart = [];
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        
        // Close modal
        closeCheckout();
        
        // Show success message
        showNotification('üéâ ƒê·∫∑t h√†ng th√†nh c√¥ng! Ch√∫ng t√¥i s·∫Ω li√™n h·ªá v·ªõi b·∫°n s·ªõm nh·∫•t.');
        
        // Reset form
        e.target.reset();
        
      } catch (error) {
        console.error('Error placing order:', error);
        showNotification('‚ùå C√≥ l·ªói x·∫£y ra khi ƒë·∫∑t h√†ng. Vui l√≤ng th·ª≠ l·∫°i!');
      } finally {
        // Reset button
        const submitBtn = e.target.querySelector('.btn-place-order');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });

    // Show notification
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #4CAF50;
        color: white;
        padding: 15px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        z-index: 1000;
        animation: slideIn 0.3s ease;
        max-width: 300px;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 4000);
    }

    // Render products
    function renderProducts(products) {
      const grid = document.getElementById('productsGrid');
      const stats = document.getElementById('productsStats');
      
      if (products.length === 0) {
        grid.innerHTML = '<div class="no-products">üòî Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o ph√π h·ª£p</div>';
        stats.innerHTML = 'Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o';
        return;
      }

      stats.innerHTML = `Hi·ªÉn th·ªã ${products.length} s·∫£n ph·∫©m`;
      
      grid.innerHTML = products.map(product => `
        <article class="product-card">
          <div class="product-image">
            <img src="${product.imageUrl}" alt="${product.name}" 
                 onerror="this.src='https://via.placeholder.com/320x250/4CAF50/white?text=üå±+${encodeURIComponent(product.name)}'">
            <div class="category-badge">${product.category}</div>
          </div>
          <div class="product-content">
            <h3 class="product-name">${product.name}</h3>
            <p class="product-description">${product.description}</p>
            <div class="product-price">${product.price?.toLocaleString('vi-VN')} ƒë</div>
            <div class="product-actions">
              <button class="btn btn-primary" onclick="addToCartHandler('${product.id}')">
                üõí Th√™m V√†o Gi·ªè
              </button>
              <button class="btn btn-secondary" onclick="viewDetails('${product.id}')">
                üëÅÔ∏è Xem Chi Ti·∫øt
              </button>
            </div>
          </div>
        </article>
      `).join('');
    }

    // Filter products
    function filterProducts() {
      filteredProducts = allProducts.filter(product => {
        const matchesCategory = currentCategory === 'all' || product.category === currentCategory;
        const matchesSearch = searchTerm === '' || 
          product.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
          product.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
          product.category.toLowerCase().includes(searchTerm.toLowerCase());
        
        return matchesCategory && matchesSearch;
      });
      
      renderProducts(filteredProducts);
    }

    // Render category filters
    function renderCategoryFilters(products) {
      const categories = [...new Set(products.map(p => p.category))].sort();
      const filterContainer = document.getElementById('categoryFilter');
      
      const allButton = filterContainer.querySelector('[data-category="all"]');
      filterContainer.innerHTML = '';
      filterContainer.appendChild(allButton);
      
      categories.forEach(category => {
        const button = document.createElement('button');
        button.className = 'category-btn';
        button.setAttribute('data-category', category);
        button.textContent = category;
        button.addEventListener('click', () => {
          currentCategory = category;
          document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');
          filterProducts();
        });
        filterContainer.appendChild(button);
      });
    }

    // Listen to products changes
    const q = query(productsCol, orderBy('name'));
    onSnapshot(q, (snapshot) => {
      allProducts = [];
      snapshot.forEach(doc => {
        allProducts.push({
          id: doc.id,
          ...doc.data()
        });
      });
      
      filteredProducts = [...allProducts];
      renderProducts(filteredProducts);
      renderCategoryFilters(allProducts);
    });

    // Search functionality
    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchTerm = e.target.value;
      filterProducts();
    });

    // Category filter event
    document.addEventListener('click', (e) => {
      if (e.target.matches('.category-btn[data-category="all"]')) {
        currentCategory = 'all';
        document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
        e.target.classList.add('active');
        filterProducts();
      }
    });

    // Close modals when clicking outside
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('cart-modal')) {
        closeCart();
      }
      if (e.target.classList.contains('checkout-modal')) {
        closeCheckout();
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeCart();
        closeCheckout();
      }
    });

    // Global functions for onclick handlers
    window.addToCartHandler = function(productId) {
      const product = allProducts.find(p => p.id === productId);
      if (product) {
        addToCart(product);
      }
    };

    window.viewDetails = function(productId) {
      const product = allProducts.find(p => p.id === productId);
      if (product) {
        alert(`Chi ti·∫øt s·∫£n ph·∫©m:\n\nT√™n: ${product.name}\nGi√°: ${product.price?.toLocaleString('vi-VN')} ƒë\nDanh m·ª•c: ${product.category}\nM√¥ t·∫£: ${product.description}`);
      }
    };

    window.openCart = openCart;
    window.closeCart = closeCart;
    window.removeFromCart = removeFromCart;
    window.updateCartQuantity = updateCartQuantity;
    window.clearCart = clearCart;
    window.proceedToCheckout = proceedToCheckout;
    window.closeCheckout = closeCheckout;

    // Initialize cart count
    updateCartCount();
  </script>
  <script src="https://cdn.emailjs.com/sdk/3.11.0/email.min.js"></script>
<script>
  emailjs.init("FqC2GXsqbfusjN6-F"); 
</script>

</body>
</html>