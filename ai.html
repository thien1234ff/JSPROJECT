<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriBot - Tr·ª£ l√Ω N√¥ng nghi·ªáp Th√¥ng minh</title>
    <link rel="icon" type="image/png" href="logo.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .chatbot-container {
            width: 100%;
            max-width: 450px;
            height: 600px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="white" opacity="0.1"/><circle cx="20" cy="20" r="1" fill="white" opacity="0.1"/><circle cx="80" cy="30" r="1.5" fill="white" opacity="0.1"/><circle cx="30" cy="80" r="1" fill="white" opacity="0.1"/><circle cx="70" cy="70" r="1" fill="white" opacity="0.1"/></svg>');
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .bot-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #81C784 0%, #4CAF50 100%);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            position: relative;
            z-index: 1;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .bot-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .bot-status {
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
            scroll-behavior: smooth;
        }

        .message {
            margin-bottom: 15px;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.bot {
            text-align: left;
        }

        .message.user {
            text-align: right;
        }

        .message-content {
            display: inline-block;
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            position: relative;
        }

        .message.bot .message-content {
            background: linear-gradient(135deg, #E8F5E8 0%, #C8E6C9 100%);
            color: #2E7D32;
            border-bottom-left-radius: 6px;
            margin-left: 0;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            color: white;
            border-bottom-right-radius: 6px;
            margin-right: 0;
        }

        .timestamp {
            font-size: 11px;
            opacity: 0.6;
            margin-top: 5px;
        }

        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .message-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }

        .message-input:focus {
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .send-button {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #4CAF50 0%, #2E7D32 100%);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(76, 175, 80, 0.3);
        }

        .send-button:active {
            transform: scale(0.95);
        }

        .typing-indicator {
            display: none;
            padding: 10px 16px;
            background: linear-gradient(135deg, #E8F5E8 0%, #C8E6C9 100%);
            border-radius: 18px;
            border-bottom-left-radius: 6px;
            max-width: 80%;
            margin-bottom: 15px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: scale(0.8); }
            30% { opacity: 1; transform: scale(1); }
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .quick-action {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4CAF50;
            color: #2E7D32;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-action:hover {
            background: #4CAF50;
            color: white;
            transform: translateY(-2px);
        }

        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #4CAF50 #f0f0f0;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #f0f0f0;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #4CAF50;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb:hover {
            background: #2E7D32;
        }

        @media (max-width: 480px) {
            .chatbot-container {
                max-width: 100%;
                height: 100vh;
                border-radius: 0;
            }
            
            .message-content {
                max-width: 90%;
            }
        }
    </style>
</head>
<body>
    <div class="chatbot-container">
        <div class="header">
            <div class="bot-avatar">üå±</div>
            <div class="bot-name">AgriBot</div>
            <div class="bot-status">Tr·ª£ l√Ω N√¥ng nghi·ªáp Th√¥ng minh</div>
        </div>

        <div class="chat-messages scrollbar-thin" id="chatMessages">
            <div class="message bot">
                <div class="message-content">
                    Xin ch√†o! T√¥i l√† AgriBot, tr·ª£ l√Ω n√¥ng nghi·ªáp th√¥ng minh ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi AI. ü§ñüåæ
                    <br><br>
                    T√¥i c√≥ th·ªÉ gi√∫p b·∫°n v·ªÅ:
                    <br>‚Ä¢ D·ª± b√°o th·ªùi ti·∫øt v√† kh√≠ h·∫≠u
                    <br>‚Ä¢ Qu·∫£n l√Ω c√¢y tr·ªìng v√† v·∫≠t nu√¥i
                    <br>‚Ä¢ Gi√°m s√°t c·∫£m bi·∫øn IoT
                    <br>‚Ä¢ Ph√¢n t√≠ch d·ªØ li·ªáu n√¥ng nghi·ªáp
                    <br>‚Ä¢ T∆∞ v·∫•n k·ªπ thu·∫≠t canh t√°c
                    <br><br>
                    <small>üí° Hi·ªán t·∫°i ƒëang s·ª≠ d·ª•ng ch·∫ø ƒë·ªô Local. ƒê·ªÉ k√≠ch ho·∫°t AI, vui l√≤ng c·∫•u h√¨nh API key.</small>
                </div>
                <div class="timestamp">10:30 AM</div>
                <div class="quick-actions">
                    <div class="quick-action" onclick="sendQuickMessage('D·ª± b√°o th·ªùi ti·∫øt h√¥m nay')">üå§Ô∏è Th·ªùi ti·∫øt</div>
                    <div class="quick-action" onclick="sendQuickMessage('Ki·ªÉm tra c·∫£m bi·∫øn')">üìä C·∫£m bi·∫øn</div>
                    <div class="quick-action" onclick="sendQuickMessage('T∆∞ v·∫•n c√¢y tr·ªìng')">üå± T∆∞ v·∫•n</div>
                    <div class="quick-action" onclick="sendQuickMessage('B√°o c√°o s·∫£n xu·∫•t')">üìã B√°o c√°o</div>
                    <div class="quick-action" onclick="toggleAIMode()">ü§ñ Ch·∫ø ƒë·ªô AI</div>
                </div>
            </div>
        </div>

        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <div class="dot"></div>
                <div class="dot"></div>
                <div class="dot"></div>
                <span style="margin-left: 10px; font-size: 12px; color: #4CAF50;">AgriBot ƒëang so·∫°n tin...</span>
            </div>
        </div>

        <div class="input-container">
            <input type="text" class="message-input" id="messageInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." onkeypress="handleKeyPress(event)">
            <button class="send-button" onclick="sendMessage()">
                <span>‚û§</span>
            </button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const typingIndicator = document.getElementById('typingIndicator');

        // C·∫•u h√¨nh AI Model
        const AI_CONFIG = {
            // Ho·∫∑c s·ª≠ d·ª•ng local model v·ªõi Ollama
            ollamaApiUrl: 'http://localhost:11500/api/chat',
            // Ch·∫ø ƒë·ªô hi·ªán t·∫°i: 'huggingface', 'ollama', 'openai', 'local'
            mode: 'ollama', // B·∫Øt ƒë·∫ßu v·ªõi local responses, c√≥ th·ªÉ chuy·ªÉn sang AI
            // System prompt cho n√¥ng nghi·ªáp th√¥ng minh
            systemPrompt: `B·∫°n l√† AgriBot, m·ªôt tr·ª£ l√Ω AI chuy√™n v·ªÅ n√¥ng nghi·ªáp th√¥ng minh. 
            B·∫°n c√≥ ki·∫øn th·ª©c s√¢u v·ªÅ:
            - Canh t√°c th√¥ng minh v√† IoT n√¥ng nghi·ªáp
            - D·ª± b√°o th·ªùi ti·∫øt v√† kh√≠ h·∫≠u
            - Qu·∫£n l√Ω c√¢y tr·ªìng, v·∫≠t nu√¥i
            - Ph√¢n t√≠ch d·ªØ li·ªáu n√¥ng nghi·ªáp
            - T∆∞ v·∫•n k·ªπ thu·∫≠t canh t√°c
            - H·ªá th·ªëng t∆∞·ªõi ti√™u t·ª± ƒë·ªông
            - Gi√°m s√°t c·∫£m bi·∫øn (ƒë·ªô ·∫©m, nhi·ªát ƒë·ªô, pH, √°nh s√°ng)
            
            H√£y tr·∫£ l·ªùi m·ªôt c√°ch th√¢n thi·ªán, chuy√™n nghi·ªáp v√† h·ªØu √≠ch b·∫±ng ti·∫øng Vi·ªát.
            S·ª≠ d·ª•ng emoji ph√π h·ª£p ƒë·ªÉ l√†m cho c√¢u tr·∫£ l·ªùi sinh ƒë·ªông h∆°n.`
        };

        // Fallback responses khi kh√¥ng th·ªÉ k·∫øt n·ªëi AI
        const fallbackResponses = {
            'th·ªùi ti·∫øt': [
                'H√¥m nay tr·ªùi n·∫Øng nh·∫π, nhi·ªát ƒë·ªô 25-30¬∞C, ƒë·ªô ·∫©m 70%. Th√≠ch h·ª£p cho vi·ªác t∆∞·ªõi n∆∞·ªõc v√†o s√°ng s·ªõm. üå§Ô∏è',
                'D·ª± b√°o c√≥ m∆∞a nh·∫π chi·ªÅu nay, b·∫°n n√™n che ch·∫Øn cho c√¢y non. Nhi·ªát ƒë·ªô gi·∫£m xu·ªëng 22-26¬∞C. üåßÔ∏è'
            ],
            'c·∫£m bi·∫øn': [
                'üìä Tr·∫°ng th√°i c·∫£m bi·∫øn hi·ªán t·∫°i:\n‚Ä¢ ƒê·ªô ·∫©m ƒë·∫•t: 65% - T·ªët\n‚Ä¢ Nhi·ªát ƒë·ªô: 28¬∞C - B√¨nh th∆∞·ªùng\n‚Ä¢ pH ƒë·∫•t: 6.5 - L√Ω t∆∞·ªüng\n‚Ä¢ √Ånh s√°ng: 85% - ƒê·ªß s√°ng',
                '‚ö†Ô∏è C·∫£nh b√°o: ƒê·ªô ·∫©m ƒë·∫•t khu v·ª±c A gi·∫£m xu·ªëng 30%. Khuy·∫øn ngh·ªã t∆∞·ªõi n∆∞·ªõc ngay. C·∫£m bi·∫øn nhi·ªát ƒë·ªô ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng.'
            ],
            't∆∞ v·∫•n': [
                'üå± D·ª±a v√†o d·ªØ li·ªáu hi·ªán t·∫°i, t√¥i khuy√™n b·∫°n:\n‚Ä¢ T∆∞·ªõi n∆∞·ªõc v√†o 6h s√°ng v√† 5h chi·ªÅu\n‚Ä¢ B√≥n ph√¢n h·ªØu c∆° tu·∫ßn t·ªõi\n‚Ä¢ Ki·ªÉm tra s√¢u b·ªánh ƒë·ªãnh k·ª≥',
                'üåæ Th·ªùi ƒëi·ªÉm n√†y th√≠ch h·ª£p tr·ªìng rau m√†u. N√™n ch·ªçn gi·ªëng ch·ªãu nhi·ªát v√† chu·∫©n b·ªã h·ªá th·ªëng t∆∞·ªõi nh·ªè gi·ªçt.'
            ],
            'b√°o c√°o': [
                'üìã B√°o c√°o tu·∫ßn n√†y:\n‚Ä¢ S·∫£n l∆∞·ª£ng d·ª± ki·∫øn: 1.2 t·∫•n\n‚Ä¢ TƒÉng tr∆∞·ªüng: +15% so v·ªõi tu·∫ßn tr∆∞·ªõc\n‚Ä¢ Chi ph√≠: 2.5 tri·ªáu VND\n‚Ä¢ L·ª£i nhu·∫≠n ∆∞·ªõc t√≠nh: 8.5 tri·ªáu VND',
                'üìà Hi·ªáu su·∫•t canh t√°c th√°ng n√†y tƒÉng 20% nh·ªù h·ªá th·ªëng t∆∞·ªõi t·ª± ƒë·ªông. Khuy·∫øn ngh·ªã m·ªü r·ªông quy m√¥ s·∫£n xu·∫•t.'
            ],
            'default': [
                'Xin l·ªói, t√¥i ch∆∞a hi·ªÉu r√µ c√¢u h·ªèi c·ªßa b·∫°n. B·∫°n c√≥ th·ªÉ h·ªèi v·ªÅ th·ªùi ti·∫øt, c·∫£m bi·∫øn, t∆∞ v·∫•n k·ªπ thu·∫≠t hay b√°o c√°o s·∫£n xu·∫•t kh√¥ng? ü§î',
                'T√¥i c√≥ th·ªÉ gi√∫p b·∫°n v·ªÅ c√°c v·∫•n ƒë·ªÅ n√¥ng nghi·ªáp th√¥ng minh. H√£y th·ª≠ h·ªèi v·ªÅ d·ª± b√°o th·ªùi ti·∫øt, tr·∫°ng th√°i c·∫£m bi·∫øn, ho·∫∑c t∆∞ v·∫•n canh t√°c nh√©! üå±'
            ]
        };

        function getCurrentTime() {
            const now = new Date();
            return now.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' });
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'bot'}`;
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="timestamp">${getCurrentTime()}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        // H√†m g·ªçi AI API
        async function callAIAPI(message) {
            try {
                let response;
                
                switch (AI_CONFIG.mode) {
                    case 'huggingface':
                        response = await callHuggingFaceAPI(message);
                        break;
                    case 'ollama':
                        response = await callOllamaAPI(message);
                        break;
                    case 'openai':
                        response = await callOpenAIAPI(message);
                        break;
                    case 'local':
                    default:
                        response = getFallbackResponse(message);
                        break;
                }
                
                return response;
            } catch (error) {
                console.error('AI API Error:', error);
                return getFallbackResponse(message);
            }
        }

        // Hugging Face API (Mi·ªÖn ph√≠)
        async function callHuggingFaceAPI(message) {
            const response = await fetch(AI_CONFIG.huggingFaceApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    // Th√™m API key n·∫øu c√≥: 'Authorization': 'Bearer YOUR_HF_TOKEN'
                },
                body: JSON.stringify({
                    inputs: `${AI_CONFIG.systemPrompt}\n\nNg∆∞·ªùi d√πng: ${message}\nAgriBot:`,
                    parameters: {
                        max_new_tokens: 200,
                        temperature: 0.7,
                        return_full_text: false
                    }
                })
            });
            
            const data = await response.json();
            return data[0]?.generated_text || getFallbackResponse(message);
        }

        // Ollama API (Local, mi·ªÖn ph√≠)
        async function callOllamaAPI(message) {
          const response = await fetch(AI_CONFIG.ollamaApiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "mistral", // ho·∫∑c llama3, phi3... tu·ª≥ model b·∫°n ch·∫°y
              messages: [
                  {
                      role: "system",
                      content: AI_CONFIG.systemPrompt,
                  },
                  {
                      role: "user",
                      content: message,
                  }
              ],
              stream: false
            }),
          });

          const data = await response.json();

          // Tr√≠ch n·ªôi dung tr·∫£ l·ªùi
          return data.message?.content || getFallbackResponse(message);
        }


        // OpenAI API (ho·∫∑c API t∆∞∆°ng th√≠ch)
        async function callOpenAIAPI(message) {
            const response = await fetch(AI_CONFIG.openAIApiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer YOUR_API_KEY' // Thay b·∫±ng API key th·ª±c
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [
                        { role: 'system', content: AI_CONFIG.systemPrompt },
                        { role: 'user', content: message }
                    ],
                    max_tokens: 200,
                    temperature: 0.7
                })
            });
            
            const data = await response.json();
            return data.choices[0]?.message?.content || getFallbackResponse(message);
        }

        // Fallback responses khi AI kh√¥ng kh·∫£ d·ª•ng
        function getFallbackResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('th·ªùi ti·∫øt') || lowerMessage.includes('thoi tiet')) {
                return fallbackResponses['th·ªùi ti·∫øt'][Math.floor(Math.random() * fallbackResponses['th·ªùi ti·∫øt'].length)];
            } else if (lowerMessage.includes('c·∫£m bi·∫øn') || lowerMessage.includes('cam bien') || lowerMessage.includes('sensor')) {
                return fallbackResponses['c·∫£m bi·∫øn'][Math.floor(Math.random() * fallbackResponses['c·∫£m bi·∫øn'].length)];
            } else if (lowerMessage.includes('t∆∞ v·∫•n') || lowerMessage.includes('tu van') || lowerMessage.includes('c√¢y tr·ªìng')) {
                return fallbackResponses['t∆∞ v·∫•n'][Math.floor(Math.random() * fallbackResponses['t∆∞ v·∫•n'].length)];
            } else if (lowerMessage.includes('b√°o c√°o') || lowerMessage.includes('bao cao') || lowerMessage.includes('s·∫£n xu·∫•t')) {
                return fallbackResponses['b√°o c√°o'][Math.floor(Math.random() * fallbackResponses['b√°o c√°o'].length)];
            } else {
                return fallbackResponses['default'][Math.floor(Math.random() * fallbackResponses['default'].length)];
            }
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            messageInput.value = '';

            showTypingIndicator();
            
            // G·ªçi AI API
            callAIAPI(message).then(response => {
                hideTypingIndicator();
                addMessage(response);
            }).catch(error => {
                console.error('Error:', error);
                hideTypingIndicator();
                addMessage('Xin l·ªói, t√¥i ƒëang g·∫∑p s·ª± c·ªë k·ªπ thu·∫≠t. Vui l√≤ng th·ª≠ l·∫°i sau. üîß');
            });
        }

        function sendQuickMessage(message) {
            messageInput.value = message;
            sendMessage();
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Auto-focus input
        messageInput.focus();
    </script>
</body>
</html>